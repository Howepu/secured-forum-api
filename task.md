Техническое Задание: RESTful API для Блога/Форума
Этот проект будет представлять собой бессерверный (stateless) RESTful API для базовой системы блога или форума, где основное внимание уделяется современным механизмам безопасности на основе токенов и интеграции с внешними провайдерами аутентификации.

1. Цель Проекта
   Изучить и реализовать различные аспекты Spring Security в контексте RESTful API, включая:

Аутентификацию на основе JSON Web Tokens (JWT).

Авторизацию на основе ролей и прав доступа.

Интеграцию с OAuth2 (например, Google, GitHub) для входа через сторонние сервисы.

Понимание и настройку SecurityFilterChain для безстатусных API.

Защиту от распространённых уязвимостей в API.

2. Основные Функциональные Требования (MVP)
   Проект должен включать следующие сущности и связанные с ними API-эндпоинты:

2.1. Пользователи (Users)
Регистрация: /api/auth/register (POST) – создание нового пользователя. Пароли должны быть захешированы с использованием BCryptPasswordEncoder.

Вход: /api/auth/login (POST) – аутентификация по логину/паролю. В ответ выдаётся JWT.

OAuth2 Вход: /oauth2/authorization/{provider} (GET) и /login/oauth2/code/{provider} (GET) – инициирование и обработка входа через OAuth2 провайдера (минимум один, например, Google).

Получение профиля: /api/users/me (GET) – доступно только аутентифицированным пользователям.

Управление ролями: (Для ADMIN) /api/admin/users/{id}/roles (PUT/POST) – изменение ролей пользователя.

2.2. Посты (Posts)
Создание поста: /api/posts (POST) – требуется аутентификация, роль USER или ADMIN.

Просмотр всех постов: /api/posts (GET) – доступно без аутентификации.

Просмотр конкретного поста: /api/posts/{id} (GET) – доступно без аутентификации.

Редактирование поста: /api/posts/{id} (PUT) – требуется аутентификация. Только автор поста или ADMIN может редактировать.

Удаление поста: /api/posts/{id} (DELETE) – требуется аутентификация. Только автор поста или ADMIN может удалять.

2.3. Комментарии (Comments)
Создание комментария: /api/posts/{postId}/comments (POST) – требуется аутентификация, роль USER или ADMIN.

Просмотр комментариев к посту: /api/posts/{postId}/comments (GET) – доступно без аутентификации.

Редактирование комментария: /api/comments/{id} (PUT) – требуется аутентификация. Только автор комментария или ADMIN может редактировать.

Удаление комментария: /api/comments/{id} (DELETE) – требуется аутентификация. Только автор комментария или ADMIN может удалять.

3. Технические Требования
   3.1. Технологический Стек
   Backend: Spring Boot (актуальная стабильная версия).

Безопасность: Spring Security.

База данных: H2 (для простоты разработки) или PostgreSQL/MySQL (для более реалистичного развёртывания). JPA/Hibernate.

Сборка: Maven или Gradle.

Тестирование: JUnit 5, Mockito.

3.2. Архитектура Безопасности
Stateless API: Сервер не хранит состояние сессий. Каждое защищенное API-запрос должен содержать JWT в заголовке Authorization: Bearer <token>.

JWT Generation & Validation:

При успешной аутентификации (логин или OAuth2) сервер генерирует JWT, содержащий информацию о пользователе (ID, роли).

JWT должен иметь срок действия (expiring token).

Для каждого защищённого запроса JWT должен быть извлечен, валидирован и на его основе должен быть создан Authentication объект в контексте Spring Security.

Ролевая Авторизация:

Используются аннотации @PreAuthorize и/или конфигурация HttpSecurity для ограничения доступа к эндпоинтам и методам на основе ролей (ROLE_USER, ROLE_ADMIN).

Реализация UserDetailsService для загрузки пользователей по логину.

OAuth2 Integration:

Настройка spring-security-oauth2-client для интеграции с OAuth2 провайдерами (например, Google).

При успешном входе через OAuth2, пользователь либо связывается с существующим аккаунтом, либо создается новый.

После OAuth2 аутентификации должен быть выпущен внутренний JWT для дальнейшего взаимодействия с API.

Обработка Исключений Безопасности:

Корректная обработка AuthenticationException (401 Unauthorized) и AccessDeniedException (403 Forbidden) с предоставлением понятных JSON-ответов.

Настройка AuthenticationEntryPoint и AccessDeniedHandler.

Хэширование Паролей: Обязательное использование BCryptPasswordEncoder.

4. Нефункциональные Требования
   Производительность: API должно отвечать в разумные сроки.

Безопасность: Минимизация известных уязвимостей (CSRF отключен и обоснован, XSS предотвращается на фронтенде/валидацией ввода).

Тестирование: Юнит- и интеграционные тесты для всех ключевых компонентов безопасности.

5. Дополнительные Возможности (если останется время)
   Refresh Tokens: Механизм обновления JWT для повышения безопасности и удобства использования.

Pagination & Sorting: Для списков постов и комментариев.

Профили пользователей: Возможность добавления дополнительных полей (аватар, био).

Возможность комментирования комментариев: Древовидная структура.

Этот проект даст вам всестороннее понимание того, как строится безопасность в современных API на Spring Boot. Он позволит вам столкнуться с реальными вызовами и решениями, которые мы используем каждый день.